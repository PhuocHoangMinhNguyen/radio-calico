<audio #audioPlayer class="audio-player">
  Your browser does not support the audio element.
</audio>

<div class="player-bar-container">
  <!-- Left: Track Info -->
  <div class="track-info">
    @if (hasTrackInfo()) {
      @if (coverUrl()) {
        <img [src]="coverUrl()" alt="Album art" class="track-cover" />
      }
      <div class="track-details">
        <span class="track-title">{{ currentTrack()!.title }}</span>
        <span class="track-artist">{{ currentTrack()!.artist }}</span>
      </div>
    } @else {
      <div class="track-details">
        <span class="track-title placeholder">{{ statusMessage() }}</span>
      </div>
    }
  </div>

  <!-- Center: Playback Controls -->
  <div class="playback-controls">
    <button
      class="play-btn"
      type="button"
      (click)="onTogglePlayPause()"
      [attr.aria-label]="isPlaying() ? 'Pause' : 'Play'"
    >
      @if (isPlaying()) {
        <span class="material-icons" aria-hidden="true">pause</span>
      } @else {
        <span class="material-icons" aria-hidden="true">play_arrow</span>
      }
    </button>
  </div>

  <!-- Mobile Actions (hidden on desktop where sidebar is visible) -->
  <div class="mobile-actions">
    <app-sleep-timer-button />
    @if (notificationsSupported && notificationPermission() !== 'denied') {
      <button
        class="notification-btn"
        type="button"
        [class.active]="notificationsEnabled()"
        (click)="onNotificationToggle()"
        [attr.aria-label]="notificationPermission() === 'default' ? 'Enable notifications' : (notificationsEnabled() ? 'Disable notifications' : 'Enable notifications')"
        [attr.aria-pressed]="notificationPermission() === 'granted' ? notificationsEnabled() : undefined"
      >
        @if (notificationPermission() === 'default') {
          <span class="material-icons" aria-hidden="true">notifications</span>
        } @else if (notificationsEnabled()) {
          <span class="material-icons" aria-hidden="true">notifications_active</span>
        } @else {
          <span class="material-icons" aria-hidden="true">notifications_off</span>
        }
      </button>
    }
  </div>

  <!-- Right: Volume & Extra Controls -->
  <div class="volume-section" [class.muted]="isMuted() || volume() === 0">
    <app-stream-quality />
    <app-sleep-timer-button class="desktop-only" />
    <button
      class="volume-btn"
      type="button"
      (click)="onToggleMute()"
      [attr.aria-label]="isMuted() || volume() === 0 ? 'Unmute' : 'Mute'"
    >
      <span class="material-icons volume-icon" aria-hidden="true">{{ volumeIcon() }}</span>
    </button>
    <input
      type="range"
      min="0"
      max="100"
      [value]="isMuted() ? 0 : volume() * 100"
      class="volume-slider"
      (input)="onVolumeChange($event)"
      aria-label="Volume"
      [attr.aria-valuenow]="isMuted() ? 0 : volume() * 100"
    />
  </div>
</div>

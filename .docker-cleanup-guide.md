# Docker Cleanup Quick Reference

## New Make Targets for Docker Cleanup

### Stopping Services

```bash
# Stop development environment
docker-compose down

# Stop production environment
docker-compose -f docker-compose.prod.yml down
make docker-down-prod

# Force stop BOTH environments with orphan removal
make docker-down-force
```

### Cleanup Commands (Safe → Destructive)

#### 1. Safe Cleanup (Preserves Data)

```bash
# Remove stopped containers, networks, and images (keeps volumes/data)
make docker-clean
```

This runs:
- `docker container prune -f`
- `docker network prune -f`
- `docker image prune -f`

#### 2. Selective Cleanup

```bash
# Remove only stopped containers
make docker-clean-containers

# Remove only unused networks
make docker-clean-networks

# Remove only unused images
make docker-clean-images
```

#### 3. ⚠️ Destructive Cleanup (Data Loss)

```bash
# Remove unused volumes (DATABASE DATA WILL BE LOST)
make docker-clean-volumes

# Nuclear option - remove EVERYTHING
make docker-clean-all
```

**Warning:** `docker-clean-volumes` and `docker-clean-all` will delete your database data!

### Troubleshooting "Resource in use" Errors

If you get "Network is still in use" or similar errors:

```bash
# Option 1: Use force cleanup
make docker-down-force

# Option 2: Manual cleanup
docker stop $(docker ps -q)          # Stop all containers
docker rm $(docker ps -aq)           # Remove all containers
docker network prune -f              # Remove unused networks

# Option 3: Check what's using a network
docker network inspect <network-name>
```

### Common Scenarios

**Scenario 1: Clean restart of development environment**
```bash
docker-compose down
make docker-clean
docker-compose up
```

**Scenario 2: Switch from production to development**
```bash
make docker-down-prod
docker-compose up
```

**Scenario 3: Free up disk space (safe)**
```bash
make docker-clean
```

**Scenario 4: Complete reset (destructive)**
```bash
make docker-down-force
make docker-clean-all
# You'll need to reinitialize the database after this
```

**Scenario 5: Remove orphaned networks/containers**
```bash
make docker-down-force
```

### Disk Space Management

Check Docker disk usage:
```bash
docker system df
```

See detailed breakdown:
```bash
docker system df -v
```

### Integration with Security

Run security scans in Docker:
```bash
make docker-security
```

Run full test suite in Docker:
```bash
make docker-test
```

---

**Note:** Always use `make docker-clean` for routine cleanup. Only use `docker-clean-volumes` or `docker-clean-all` when you're sure you want to delete database data.
